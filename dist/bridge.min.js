!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).Bridge=e()}(this,(function(){"use strict";return{of:function(n){var e="bridge_"+n,t=window[e];if(null!=t)return t;t={},window[e]=t;var o=function(n,e,t,o,l){var i={};return null!=n&&(i.id=n),null!=e&&(i.type=e),null!=t&&(i.method=t),null!=o&&(i.payload=o),null!=l&&(i.error=l),i},l="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var e=16*Math.random()|0;return("x"===n?e:3&e|8).toString(16)})),i=[],u=!1,r=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.from=l,e.to=n,!1!==t||!1!==u){var o={};o[n]=e,window.top.postMessage(o,"*")}else i.push(e)},c=0;t.emit=function(n,e){r(o(c++,"emit",n,e,null))};var d={},a=function(n,e,t){var l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=d[n];null!=i&&(!0===l&&delete d[n],"cancelled"!==t&&"disconnected"!==t||r(o(n,"cancel",null,null,null)),null!=i.timeoutContext&&(window.clearTimeout(i.timeoutContext),i.timeoutContext=null),null==t?i.resolve(e):i.reject(t))};t.deliver=function(n,e){var t=c++;r(o(t,"deliver",n,e,null));var l={};d[t]=l;var i=new Promise((function(n,e){l.resolve=n,l.reject=e}));return i.setTimeout=function(n){return null!=l.timeoutContext&&window.clearTimeout(l.timeoutContext),l.timeoutContext=window.setTimeout((function(){a(t,null,"timed out")}),n),this},i.setCancelToken=function(n){return n.cancel=function(){a(t,null,"cancelled")},this},i};var f={};t.on=function(n){var e=f[n];return null==e&&(e={event:function(n){return this.onEvent=n,this},cancel:function(n){return this.onCancel=n,this}},f[n]=e),e};var v={};window.addEventListener("message",(function(e){var t=e.data,c=e.source;try{var d=t[n];if(null==d)return;var s=d.id,x=d.to,m=d.type,p=d.method,h=d.payload,w=d.error;if("load"===m){if(c===window.top){if(!0===u)return;u=!0;var g=f.connect;null!=g&&g.onEvent(h,(function(){})),r(o(null,"connect")),i.forEach((function(n){r(n)})),i.splice(0,i.length)}return}if(x!==l)return;if("ack"===m)return void a(s,h,w);if("cancel"===m){var y=v[s];if(null==y)return;y()}if("emit"===m){var C=f[p];if(null==C)return;return void C.onEvent(h)}if("deliver"===m){var E=!1,T=function(n,e,t){r(o(n,"ack",null,e,t))},b=f[p];if(null==b)return void T(null,"unsupported method");var j=b.onEvent(h,(function(n,e){!0!==E&&(E=!0,T(s,n,e),delete v[s])})),k=b.onCancel;if(null==k)return;v[s]=function(){!0!==E&&(E=!0,k(j),delete v[s])}}}catch(n){console.log(n)}}));var s;return window.addEventListener("unload",(function(){!function(){for(var n in d)a(n,null,"disconnected",!1);r(o(null,"disconnect"))}()})),(s=document.createElement("iframe")).style.display="none",s.src="https://bridge/load?name="+encodeURIComponent(n),document.documentElement.appendChild(s),setTimeout((function(){document.documentElement.removeChild(s)}),1),t}}}));
